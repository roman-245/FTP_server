Основные изменения и дополнения:

Добавлена глобальная переменная server_running для управления состоянием сервера.
Обработка команды stop, которая устанавливает server_running в False и сигнализирует клиенту об остановке сервера.
Основной цикл сервера завершает работу при получении команды stop, закрывая сокет и останавливая сервер.